# yaml-language-server: $schema=./topology-schema.json
meta:
  id: "lab-example"
  name: "Example Lab Topology"
  description: "Example network lab configuration demonstrating the schema structure"

defaults:
  ip_forwarding: false

links:
  # Physical connections between nodes
  # Order determines interface assignment (eth1, eth2, etc.)
  - endpoints: ["R1", "R2"]
    latency: "10ms"
    loss: "0.1%"
  - endpoints: ["R2", "R3"]
  - endpoints: ["R1", "S1:eth1"]
  - endpoints: ["S1:eth2", "H1"]

nodes:
  - name: R1
    role: router
    ip_forwarding: true
    packages:
      - "bird"
      - "tcpdump"
    interfaces:
      - ip: "10.0.1.1/24"
        gateway: "10.0.1.254"
        ospf:
          area: 0
          cost: 10
          passive: false
      - ip: "10.0.2.1/24"
        ospf:
          area: 1
          cost: 20
    loopbacks:
      - ip: "192.168.1.1/32"
        ospf:
          area: 0
          passive: true
    routing:
      engine: bird
      static:
        - "10.0.3.0/24 via 10.0.1.2"
        - "default via 10.0.1.254"
    files:
      - path: "/etc/bird/bird.conf"
        content: |
          router id 192.168.1.1;
          protocol ospf {
            area 0 {
              interface "eth1";
            }
          }
        chmod: "0644"
        owner: "root:root"
    commands:
      - "sysctl -w net.ipv4.ip_forward=1"
      - "systemctl enable bird"

  - name: R2
    role: router
    ip_forwarding: true
    interfaces:
      - ip: "10.0.1.2/24"
        ospf:
          area: 0
          cost: 10
      - ip: "10.0.3.1/24"
    routing:
      engine: frr
      static:
        - "10.0.2.0/24 via 10.0.1.1"

  - name: R3
    role: router
    interfaces:
      - ip: "10.0.3.2/24"
    routing:
      engine: none

  - name: S1
    role: switch
    bridge:
      name: br0
      stp: true
      members:
        - eth1
        - eth2
        - eth3
    interfaces:
      - ip: "10.0.4.254/24"
        # Management interface on bridge

  - name: H1
    role: host
    interfaces:
      - ip: "192.168.1.10/24"
        gateway: "192.168.1.1"
    packages:
      - "curl"
      - "wget"
